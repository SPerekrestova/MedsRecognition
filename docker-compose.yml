version: "3.8"

services:
  model_server_app:
    image: sperva/model_server_app:latest
    restart: always
    deploy:
      resources:
        limits:
          memory: 6G
    networks:
      - private_network


  meds_recognition_app:
    image: sperva/meds_recognition_app:latest
    ports:
      - "80:8000"
    environment:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_KEY: ${SUPABASE_KEY}
      SUPABASE_JWT_SECRET: ${SUPABASE_JWT_SECRET}
      DATABASE_NAME: ${DATABASE_NAME}
      DATABASE_USER: ${DATABASE_USER}
      DATABASE_PASSWORD: ${DATABASE_PASSWORD}
      DATABASE_HOST: ${DATABASE_HOST}
      DATABASE_PORT: ${DATABASE_PORT}
      BIOMED_HOST: "http://model_server_app:8081"
      DJANGO_SETTINGS_MODULE: ${DJANGO_SETTINGS_MODULE}
    restart: always
    depends_on:
      - model_server_app
    networks:
      - default
      - private_network


networks:
  private_network:
    driver: bridge
  default:
    driver: bridge